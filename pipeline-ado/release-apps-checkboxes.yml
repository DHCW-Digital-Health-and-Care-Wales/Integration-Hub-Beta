# Alternative Release Pipeline with Checkbox Selection
# This version uses boolean checkboxes for each app and environment

trigger: none
pr: none

parameters:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # APPLICATION SELECTION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  - name: deployAllApps
    displayName: 'ğŸ“¦ Applications â”‚ âœ“ Deploy ALL Applications'
    type: boolean
    default: false
    
  - name: deployPHWHL7Server
    displayName: 'ğŸ“¦ Applications â”‚ â˜ PHW HL7Server'
    type: boolean
    default: false
    
  - name: deployPIMSHL7Server
    displayName: 'ğŸ“¦ Applications â”‚ â˜ PIMS HL7Server'
    type: boolean
    default: false
    
  - name: deployParisHL7Server
    displayName: 'ğŸ“¦ Applications â”‚ â˜ Paris HL7Server'
    type: boolean
    default: false
    
  - name: deployChemocareHL7Server
    displayName: 'ğŸ“¦ Applications â”‚ â˜ Chemocare HL7Server'
    type: boolean
    default: false
    
  - name: deployMPIHL7Server
    displayName: 'ğŸ“¦ Applications â”‚ â˜ MPI HL7Server'
    type: boolean
    default: false
    
  - name: deployHL7PhwTransformer
    displayName: 'ğŸ“¦ Applications â”‚ â˜ HL7 Phw Transformer'
    type: boolean
    default: false
    
  - name: deployHL7ChemoTransformer
    displayName: 'ğŸ“¦ Applications â”‚ â˜ HL7 Chemo Transformer'
    type: boolean
    default: false
    
  - name: deployHL7PimsTransformer
    displayName: 'ğŸ“¦ Applications â”‚ â˜ HL7 Pims Transformer'
    type: boolean
    default: false
    
  - name: deployHL7Sender
    displayName: 'ğŸ“¦ Applications â”‚ â˜ HL7 Sender'
    type: boolean
    default: false
    
  - name: deployPIMSHL7Sender
    displayName: 'ğŸ“¦ Applications â”‚ â˜ PIMS HL7 Sender'
    type: boolean
    default: false
    
  - name: deployChemocareHL7Sender
    displayName: 'ğŸ“¦ Applications â”‚ â˜ Chemocare HL7 Sender'
    type: boolean
    default: false
    
  - name: deployHL7MockReceiver
    displayName: 'ğŸ“¦ Applications â”‚ â˜ HL7 Mock Receiver'
    type: boolean
    default: false

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ENVIRONMENT SELECTION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  - name: deployToAllEnvironments
    displayName: 'ğŸŒ Environments â”‚ âœ“ Deploy to ALL Environments'
    type: boolean
    default: false
    
  - name: deployToDev
    displayName: 'ğŸŒ Environments â”‚ â˜ Development (dev)'
    type: boolean
    default: false
    
  - name: deployToDTE
    displayName: 'ğŸŒ Environments â”‚ â˜ DTE'
    type: boolean
    default: false
    
  - name: deployToTest
    displayName: 'ğŸŒ Environments â”‚ â˜ Test (tst)'
    type: boolean
    default: false
    
  - name: deployToPreProd
    displayName: 'ğŸŒ Environments â”‚ â˜ Pre-Production (ppd)'
    type: boolean
    default: false
    
  - name: deployToProduction
    displayName: 'ğŸŒ Environments â”‚ â˜ Production (prd)'
    type: boolean
    default: false
  
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # DEPLOYMENT OPTIONS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
  - name: maintainDependencies
    displayName: 'âš™ï¸ Options â”‚ Maintain environment dependencies (devâ†’dteâ†’tstâ†’ppdâ†’prd)?'
    type: boolean
    default: false

variables:
  # Shared Configuration
  - name: acrName
    value: 'uksdhcwihsharedcr'
  - name: azureServiceConnection
    value: 'Azure - NHSWales-DHCW-IntegrationHub-Subscription'
  - name: azureLocation
    value: 'uks'
    
  # Pool Configuration
  - name: POOL_NAME_NON_PROD
    value: 'UKS-DHCW-IH-DEV-ADOManagedPool'
  - name: POOL_NAME_PROD
    value: 'UKS-DHCW-IH-PPD-ADOManagedPool'

resources:
  pipelines:
    - pipeline: 'HL7 Server - Build'
      source: 'HL7 Server - Build'
      trigger: none
    - pipeline: 'HL7 Phw Transformer - Build'
      source: 'HL7 Phw Transformer - Build'
      trigger: none
    - pipeline: 'HL7 Chemo Transformer - Build'
      source: 'HL7 Chemo Transformer - Build'
      trigger: none
    - pipeline: 'HL7 Pims Transformer - Build'
      source: 'HL7 Pims Transformer - Build'
      trigger: none
    - pipeline: 'HL7 Sender - Build'
      source: 'HL7 Sender - Build'
      trigger: none
    - pipeline: 'HL7 Mock Receiver - Build'
      source: 'HL7 Mock Receiver - Build'
      trigger: none

stages:
  - template: templates/dynamic-stages-checkbox-template.yml
    parameters:
      # Pass all checkbox parameters
      deployAllApps: ${{ parameters.deployAllApps }}
      deployPHWHL7Server: ${{ parameters.deployPHWHL7Server }}
      deployPIMSHL7Server: ${{ parameters.deployPIMSHL7Server }}
      deployParisHL7Server: ${{ parameters.deployParisHL7Server }}
      deployChemocareHL7Server: ${{ parameters.deployChemocareHL7Server }}
      deployMPIHL7Server: ${{ parameters.deployMPIHL7Server }}
      deployHL7PhwTransformer: ${{ parameters.deployHL7PhwTransformer }}
      deployHL7ChemoTransformer: ${{ parameters.deployHL7ChemoTransformer }}
      deployHL7PimsTransformer: ${{ parameters.deployHL7PimsTransformer }}
      deployHL7Sender: ${{ parameters.deployHL7Sender }}
      deployPIMSHL7Sender: ${{ parameters.deployPIMSHL7Sender }}
      deployChemocareHL7Sender: ${{ parameters.deployChemocareHL7Sender }}
      deployHL7MockReceiver: ${{ parameters.deployHL7MockReceiver }}
      
      deployToAllEnvironments: ${{ parameters.deployToAllEnvironments }}
      deployToDev: ${{ parameters.deployToDev }}
      deployToDTE: ${{ parameters.deployToDTE }}
      deployToTest: ${{ parameters.deployToTest }}
      deployToPreProd: ${{ parameters.deployToPreProd }}
      deployToProduction: ${{ parameters.deployToProduction }}
      
      maintainDependencies: ${{ parameters.maintainDependencies }}
      
      azureLocation: $(azureLocation)
      acrName: $(acrName)
      azureServiceConnection: $(azureServiceConnection)
      
      # Application configurations
      appConfig:
        # HL7 Server Variants
        - name: 'PHW HL7Server'
          paramName: 'deployPHWHL7Server'
          appName: 'hl7server'
          appFunctionMidfix: 'phw'
          buildPipeline: 'HL7 Server - Build'
          
        - name: 'PIMS HL7Server'
          paramName: 'deployPIMSHL7Server'
          appName: 'hl7server'
          appFunctionMidfix: 'pims'
          buildPipeline: 'HL7 Server - Build'
          
        - name: 'Paris HL7Server'
          paramName: 'deployParisHL7Server'
          appName: 'hl7server'
          appFunctionMidfix: 'paris'
          buildPipeline: 'HL7 Server - Build'
          
        - name: 'Chemocare HL7Server'
          paramName: 'deployChemocareHL7Server'
          appName: 'hl7server'
          appFunctionMidfix: 'chemo'
          buildPipeline: 'HL7 Server - Build'
          
        - name: 'MPI HL7Server'
          paramName: 'deployMPIHL7Server'
          appName: 'hl7server'
          appFunctionMidfix: 'mpi'
          buildPipeline: 'HL7 Server - Build'

        # HL7 Transformer Variants
        - name: 'HL7 Phw Transformer'
          paramName: 'deployHL7PhwTransformer'
          appName: 'phw-hl7transformer'
          appFunctionMidfix: ''
          buildPipeline: 'HL7 Phw Transformer - Build'
          
        - name: 'HL7 Chemo Transformer'
          paramName: 'deployHL7ChemoTransformer'
          appName: 'chemo-hl7transformer'
          appFunctionMidfix: ''
          buildPipeline: 'HL7 Chemo Transformer - Build'
          
        - name: 'HL7 Pims Transformer'
          paramName: 'deployHL7PimsTransformer'
          appName: 'pims-hl7transformer'
          appFunctionMidfix: ''
          buildPipeline: 'HL7 Pims Transformer - Build'

        # HL7 Sender Variants
        - name: 'HL7 Sender'
          paramName: 'deployHL7Sender'
          appName: 'hl7sender'
          appFunctionMidfix: ''
          buildPipeline: 'HL7 Sender - Build'
          
        - name: 'PIMS HL7 Sender'
          paramName: 'deployPIMSHL7Sender'
          appName: 'hl7sender'
          appFunctionMidfix: 'pims'
          buildPipeline: 'HL7 Sender - Build'
          
        - name: 'Chemocare HL7 Sender'
          paramName: 'deployChemocareHL7Sender'
          appName: 'hl7sender'
          appFunctionMidfix: 'chemo'
          buildPipeline: 'HL7 Sender - Build'

        # Mock Receiver
        - name: 'HL7 Mock Receiver'
          paramName: 'deployHL7MockReceiver'
          appName: 'hl7mockreceiver'
          appFunctionMidfix: ''
          buildPipeline: 'HL7 Mock Receiver - Build'
      
      # Environment configurations
      environments:
        - name: 'dev'
          paramName: 'deployToDev'
          displayName: 'Development'
          resourceGroup: 'UK-South-DHCW-IntHub-DEV-RG'
          poolName: 'POOL_NAME_NON_PROD'
          dependsOnPrevious: false
          
        - name: 'dte'
          paramName: 'deployToDTE'
          displayName: 'DTE'
          resourceGroup: 'UK-South-DHCW-IntHub-DTE-RG'
          poolName: 'POOL_NAME_NON_PROD'
          dependsOnPrevious: true
          previousEnv: 'dev'
          
        - name: 'tst'
          paramName: 'deployToTest'
          displayName: 'Test'
          resourceGroup: 'UK-South-DHCW-IntHub-TST-RG'
          poolName: 'POOL_NAME_NON_PROD'
          dependsOnPrevious: true
          previousEnv: 'dte'
          
        - name: 'ppd'
          paramName: 'deployToPreProd'
          displayName: 'Pre-Production'
          resourceGroup: 'UK-South-DHCW-IntHub-PPD-RG'
          poolName: 'POOL_NAME_PROD'
          dependsOnPrevious: true
          previousEnv: 'tst'
          
        - name: 'prd'
          paramName: 'deployToProduction'
          displayName: 'Production'
          resourceGroup: 'UK-South-DHCW-IntHub-PRD-RG'
          poolName: 'POOL_NAME_PROD'
          dependsOnPrevious: true
          previousEnv: 'ppd'
